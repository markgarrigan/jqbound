var app=app||{};
$.extend(app,{saySomething:function(e){var r=$.Deferred();return confirm(e.speech||"Hello!")?r.resolve():r.reject(),r.promise()},doSomething:function(e){var r=$.Deferred();return confirm("I did it!")?r.resolve():r.reject(),r.promise()},sayName:function(e){var r=$.Deferred();return confirm(app.getProperty(app.models,e.name))?r.resolve():r.reject(),r.promise()},models:{},getProperty:function(e,r){var o,t=r.split("."),n=e;for(o=0;o<t.length;++o){if(void 0==n[t[o]])return void 0;n=n[t[o]]}return n},initModels:function(e){var r=String(e.models).split(",");r.forEach(function(e,r,o){$('[data-value^="'+e+'."]').each(function(){var e=$(this),r=e.data("value"),o=app.getProperty(app.models,r);if(o);else{new Model(e)}})})},wait:function(e){return $.Deferred(function(r){setTimeout(r.resolve,e)})},methods:function(e){return e.split(",")},log:function(e){window.console&&console.log(e)}});
function DataBinder(t){var e=jQuery({}),a=t.data("value")+":change";return $("body").on("change keyup","[data-value]",function(t){var n=$(this);e.trigger(a,[n.data("value"),n.val()])}),e.on(a,function(t,e,a){$('[data-value="'+e+'"]').each(function(){$(this).val(a)}),$('[data-text="'+e+'"]').each(function(){$(this)[0].textContent=a}),$('[data-html="'+e+'"]').each(function(){$(this).html(a)})}),e}function Model(t){var e=new DataBinder(t),a={set:function(t,a,n){for(var o=a.length-1,i=0;o>i;++i){var d=a[i];d in t||(t[d]={}),t=t[d]}t[a[o]]=n,e.trigger(a+":change",[a,n,this])},_binder:e};return t.val()&&a.set(app.models,path.split("."),t.val()),e.on(t.data("value")+":change",function(t,e,n,o){o!==a&&a.set(app.models,e.split("."),n)}),a}$(function(){var t=function(e,a){e.length&&$.when(app[e[0]](a)).then(function(){e.splice(0,1),t(e,a)})};$("[data-on-load]").each(function(){var e=$(this),a=e.data(),n=$.extend({element:e,value:e.val()},a,a.options),o=app.methods(a.onLoad);t(o,n)}),$("body").on("mouseenter","[data-on-enter]",function(e){var a=$(this),n=a.data(),o=$.extend({el:this,element:a,value:a.val()},n,n.options),i=app.methods(n.onEnter);t(i,o)}),$("body").on("mouseleave","[data-on-leave]",function(e){var a=$(this),n=a.data(),o=$.extend({el:this,element:a,value:a.val()},n,n.options),i=app.methods(n.onLeave);t(i,o)}),$("[data-on-keyup]").on("keyup",function(e){var a=$(this),n=a.data(),o=$.extend({element:a,value:a.val()},n,n.options),i=app.methods(n.onKeyup);t(i,o)}),$("body").on("focus","[data-on-focus]",function(e){var a=$(this),n=a.data(),o=$.extend({element:a,value:a.val()},n,n.options),i=app.methods(n.onFocus);t(i,o)}),$("body").on("change","[data-on-change]",function(e){var a=$(this),n=a.data(),o=$.extend({element:a,value:a.val()},n,n.options),i=app.methods(n.onChange);t(i,o)}),$("body").on("blur","[data-on-blur]",function(e){var a=$(this),n=a.data(),o=$.extend({element:a,value:a.val()},n,n.options),i=app.methods(n.onBlur);t(i,o)}),$("body").on("click","[data-click]",function(e){var a=$(this),n=a.data(),o=$.extend({el:this,element:a},n,n.options),i=app.methods(n.click);a.prop("disabled")||t(i,o)}),$("body").on("dblclick","[data-on-dblclick]",function(e){e.stopPropagation(),e.preventDefault();var a=$(this),n=a.data(),o=$.extend({el:this,element:a},n,n.options),i=app.methods(n.onDblclick);t(i,o)}),$("body").on("click","[data-on-click]",function(e){e.stopPropagation(),e.preventDefault();var a=$(this),n=a.data(),o=$.extend({el:this,element:a},n,n.options),i=app.methods(n.onClick);t(i,o)}),$("[data-on-submit]").on("submit",function(e){e.preventDefault();var a=$(this),n=a.data(),o=$.extend({self:this,element:a,iframe:a.attr("target")},n,a.data("options")),i=app.methods(n.onSubmit);t(i,o)})});